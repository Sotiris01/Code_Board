<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Board - Code Teaching Board</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="styles.css?v=41">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <!-- Markdown Parser (marked.js) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <!-- JSZip Library for client-side ZIP creation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
    <!-- ============================================ -->
    <!-- LOBBY OVERLAY - Waiting Room for Students -->
    <!-- ============================================ -->
    <div id="lobby-overlay" class="lobby-overlay">
        <div class="lobby-card">
            <div class="lobby-header">
                <h1 class="lobby-title">üìù Code Board</h1>
                <p class="lobby-subtitle">Collaborative Coding Classroom</p>
            </div>
            
            <div class="lobby-teacher-info">
                <h3 class="teacher-title">üë®‚Äçüè´ Teacher</h3>
                <div class="teacher-name" id="lobby-teacher-name">Loading...</div>
                <div class="teacher-contact">
                    <span id="lobby-teacher-email">üìß Loading...</span>
                    <span id="lobby-teacher-phone">üì± Loading...</span>
                    <span id="lobby-teacher-discord">üí¨ Loading...</span>
                </div>
            </div>
            
            <div class="lobby-divider"></div>
            
            <div class="lobby-form">
                <p class="lobby-instructions">Enter the 4-digit class code to join:</p>
                <div class="lobby-input-group">
                    <input 
                        type="text" 
                        id="lobby-code-input" 
                        class="lobby-code-input" 
                        maxlength="4" 
                        placeholder="‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢"
                        inputmode="numeric"
                        pattern="[0-9]*"
                        autocomplete="off"
                    >
                </div>
                <div id="lobby-error" class="lobby-error"></div>
                <button id="lobby-join-btn" class="lobby-join-btn">
                    Enter Class
                </button>
            </div>
            
            <div class="lobby-footer">
                <p>Waiting for the teacher to share the access code...</p>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- Header / Toolbar -->
        <header class="toolbar">
            <div class="toolbar-left">
                <h1 class="app-title">üìù Code Board</h1>
                
                <!-- Mode Toggle Buttons -->
                <div class="mode-toggle">
                    <button id="mode-code" class="btn btn-mode active" title="Code Editor">
                        <span class="btn-icon">üíª</span>
                        <span class="btn-text">Code</span>
                    </button>
                    <button id="mode-pdf" class="btn btn-mode" title="PDF Viewer">
                        <span class="btn-icon">üìÑ</span>
                        <span class="btn-text">PDF</span>
                    </button>
                    <button id="mode-markdown" class="btn btn-mode" title="Markdown Viewer">
                        <span class="btn-icon">üìù</span>
                        <span class="btn-text">MD</span>
                    </button>
                </div>
                
                <!-- Language Selector -->
                <div class="language-selector-container">
                    <label for="language-selector" class="language-label">Language:</label>
                    <select id="language-selector" class="language-selector" title="Select programming language">
                        <option value="glossa" selected>ŒìŒõŒ©Œ£Œ£Œë</option>
                        <option value="python">Python</option>
                        <option value="cpp">C++</option>
                        <option value="java">Java</option>
                    </select>
                </div>
            </div>
            <div class="toolbar-center">
                <!-- PDF Controls (hidden by default) -->
                <div class="pdf-controls" id="pdf-controls" style="display: none;">
                    <!-- Hidden file input triggered by mode button -->
                    <input type="file" id="pdf-file-input" accept=".pdf" style="display: none;">
                </div>
                
                <!-- Code Controls (shown by default, empty now) -->
                <div class="code-controls" id="code-controls">
                </div>
                
                <!-- Markdown Controls (hidden by default) -->
                <div class="md-controls" id="md-controls" style="display: none;">
                    <!-- Hidden file input triggered by mode button -->
                    <input type="file" id="md-file-input" accept=".md,.txt" style="display: none;">
                    <div class="md-scroll-controls">
                        <button id="md-scroll-top" class="btn btn-tool" title="Scroll to Top">
                            <span class="btn-icon">‚¨ÜÔ∏è</span>
                        </button>
                        <button id="md-scroll-bottom" class="btn btn-tool" title="Scroll to Bottom">
                            <span class="btn-icon">‚¨áÔ∏è</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="toolbar-right">
                <!-- Classroom Controls (Teacher only) -->
                <div id="classroom-controls" class="classroom-controls teacher-only" style="display: none;">
                    <div class="access-code-display">
                        <span class="access-code-label">Code:</span>
                        <span id="access-code-value" class="access-code-value">----</span>
                        <div class="access-code-actions">
                            <button id="copy-code-btn" class="code-action-btn" title="Copy Code">üìã</button>
                            <button id="cycle-code-btn" class="code-action-btn" title="New Code">üîÑ</button>
                        </div>
                    </div>
                    <div class="public-access-toggle">
                        <span class="public-access-label">Free Enter</span>
                        <div id="public-access-toggle" class="toggle-switch" title="Allow students to join without code"></div>
                    </div>
                </div>
                
                <!-- Theme Toggle -->
                <button id="theme-toggle-btn" class="btn btn-icon-only" title="Change Theme (Ctrl+Shift+T)">
                    <span class="btn-icon theme-icon">üåô</span>
                </button>
                
                <!-- Keyboard Shortcuts Help -->
                <button id="shortcuts-help-btn" class="btn btn-icon-only" title="Keyboard Shortcuts (F1)">
                    <span class="btn-icon">‚ùì</span>
                </button>
                
                <!-- Code Management -->
                <button id="copy-btn" class="btn btn-action" title="Copy Code (Ctrl+Shift+C)">
                    <span class="btn-icon">üìã</span>
                    <span class="btn-text">Copy</span>
                </button>
                <button id="clear-btn" class="btn btn-danger" title="Clear Board">
                    <span class="btn-icon">üóëÔ∏è</span>
                    <span class="btn-text">Clear</span>
                </button>
            </div>
        </header>

        <!-- Main Editor Area -->
        <main class="editor-container">
            <div class="editor-wrapper">
                <!-- Line Numbers (Code mode) -->
                <div id="line-numbers" class="line-numbers">
                    <div class="line-number">1</div>
                </div>
                
                <!-- Grid-Based Code Editor -->
                <div id="grid-editor-container" class="code-area">
                    <!-- GridEditor will be initialized here -->
                </div>
                
                <!-- PDF Viewer Container -->
                <div id="pdf-viewer-container" class="pdf-viewer-container" style="display: none;">
                    <!-- PDF will be rendered here by pdf-viewer.js -->
                </div>
                
                <!-- Markdown Viewer Container -->
                <div id="md-viewer-container" class="md-viewer-container" style="display: none;">
                    <!-- Markdown will be rendered here by MarkdownViewer.js -->
                </div>
                
                <!-- Hidden textarea for backwards compatibility (fallback) -->
                <textarea 
                    id="code-editor" 
                    class="code-editor hidden-legacy-editor" 
                    spellcheck="false"
                    style="display: none;"
                ></textarea>
            </div>
            
            <!-- Sidebar Resize Handle -->
            <div class="sidebar-resize-handle" id="sidebar-resize-handle"></div>
            
            <!-- Right Sidebar Container (Activity Bar + Side Panel) -->
            <aside class="sidebar-container" id="sidebar-container">
                <!-- Activity Bar (Vertical Icon Strip) -->
                <div class="activity-bar" id="activity-bar">
                    <button class="activity-btn active" data-panel="keywords" title="Keywords (Ctrl+1)">
                        <span class="activity-icon">‚å®Ô∏è</span>
                    </button>
                    <button class="activity-btn teacher-only" data-panel="files" title="Files (Ctrl+2)">
                        <span class="activity-icon">üìÅ</span>
                    </button>
                    <button class="activity-btn" data-panel="shared" title="Shared Files (Ctrl+3)">
                        <span class="activity-icon">üì§</span>
                    </button>
                    <button class="activity-btn teacher-only" data-panel="open-local" title="Open Local File (Ctrl+4)">
                        <span class="activity-icon">üíª</span>
                    </button>
                    <div class="activity-spacer"></div>
                    <button class="activity-btn" data-action="toggle-sidebar" title="Show/Hide sidebar">
                        <span class="activity-icon">‚óÄ</span>
                    </button>
                </div>
                
                <!-- Side Panel Content -->
                <div class="side-panel" id="side-panel">
                    <!-- Keywords Panel -->
                    <div class="sidebar-panel active" id="keywords-panel">
                        <div class="panel-header">
                            <span class="panel-title">KEYWORDS</span>
                        </div>
                        <div class="sidebar-content" id="keywords-content">
                            <!-- Keywords will be generated dynamically -->
                        </div>
                    </div>
                    
                    <!-- Files Panel -->
                    <div class="sidebar-panel" id="files-panel">
                        <div class="panel-header">
                            <span class="panel-title">FILE EXPLORER</span>
                        </div>
                        <div class="file-browser">
                            <!-- Breadcrumb Navigation -->
                            <div class="file-breadcrumb" id="file-breadcrumb">
                                <span class="breadcrumb-item breadcrumb-root" data-path="">üìÇ Loading...</span>
                            </div>
                            <!-- File List -->
                            <div class="file-list" id="file-list">
                                <!-- Files will be loaded here dynamically -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Shared Files Panel -->
                    <div class="sidebar-panel" id="shared-panel">
                        <div class="panel-header">
                            <span class="panel-title">SHARED FILES</span>
                        </div>
                        <div class="shared-content" id="shared-content">
                            <!-- Shared files content will be generated by SharedFilesBrowser.js -->
                        </div>
                    </div>
                    
                    <!-- Open Local File Panel (Teacher Only) -->
                    <div class="sidebar-panel" id="open-local-panel">
                        <div class="panel-header">
                            <span class="panel-title">LOCAL FILES</span>
                        </div>
                        <div class="open-local-content" id="open-local-content">
                            <!-- Initial state: Browse button -->
                            <div id="local-browse-initial">
                                <p class="panel-description">Open a folder from your computer to browse and load files.</p>
                                
                                <!-- Folder Picker Button -->
                                <button class="open-file-btn" id="open-local-folder-btn">
                                    <span class="btn-icon">üìÇ</span>
                                    <span class="btn-text">Open Folder...</span>
                                </button>
                                
                                <!-- Or single file -->
                                <button class="open-file-btn secondary" id="open-local-file-btn">
                                    <span class="btn-icon">üìÑ</span>
                                    <span class="btn-text">Open Single File...</span>
                                </button>
                                <input type="file" id="local-file-input" accept=".gls,.glo,.py,.cpp,.c,.h,.hpp,.java,.txt" style="display: none;">
                            </div>
                            
                            <!-- After folder selected: File browser -->
                            <div id="local-folder-browser" style="display: none;">
                                <div class="local-folder-header">
                                    <button id="local-folder-change" class="btn-icon-only" title="Change Folder">üìÇ</button>
                                    <span id="local-folder-name" class="local-folder-name">Folder</span>
                                </div>
                                <div id="local-breadcrumb" class="file-breadcrumb"></div>
                                <div id="local-file-list" class="file-list"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </main>

        <!-- Footer / Status Bar -->
        <footer class="status-bar">
            <div class="status-left">
                <!-- Cursor Position (VS Code style) -->
                <span id="cursor-position" class="status-item">Ln 1, Col 1</span>
                <span class="status-item" id="network-upload" title="Upload per second">‚Üë 0 B/s</span>
                <span class="status-item" id="network-download" title="Download per second">‚Üì 0 B/s</span>
            </div>
            <div class="status-center">
                <!-- Session Timer -->
                <span id="session-timer" class="status-item session-timer" title="Session Duration">‚è±Ô∏è 00:00</span>
                <!-- Student List (Teacher only) -->
                <div id="student-list-toggle" class="status-item student-list-toggle teacher-only" title="Connected Students">
                    <span class="student-icon">üë•</span>
                    <span id="student-count" class="student-count">0</span>
                </div>
                <!-- Ngrok Stats (Teacher only) -->
                <div id="ngrok-stats" class="ngrok-stats" style="display: none;">
                    <span class="ngrok-icon">üåê</span>
                    <span id="ngrok-latency" class="ngrok-latency" title="Connection Latency">--ms</span>
                    <span id="ngrok-connections" class="ngrok-connections" title="Active Connections">0 üë•</span>
                </div>
            </div>
            <div class="status-right">
                <!-- Emoji Reactions (Student only) -->
                <div id="emoji-reactions" class="emoji-reactions student-only">
                    <button class="reaction-btn" data-reaction="understood" title="Understood">‚úÖ</button>
                    <button class="reaction-btn" data-reaction="confused" title="Confused">‚ùì</button>
                    <button class="reaction-btn" data-reaction="repeat" title="Repeat">üîÑ</button>
                </div>
                <!-- Teacher: Reaction Counts -->
                <div id="reaction-counts" class="reaction-counts teacher-only" style="display: none;">
                    <span class="reaction-count" data-reaction="understood">‚úÖ <span>0</span></span>
                    <span class="reaction-count" data-reaction="confused">‚ùì <span>0</span></span>
                    <span class="reaction-count" data-reaction="repeat">üîÑ <span>0</span></span>
                </div>
                <!-- Language Badge -->
                <span id="status-language" class="status-item status-language">GLOSSA</span>
            </div>
        </footer>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
        <span id="toast-message"></span>
    </div>
    
    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcuts-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content shortcuts-modal-content">
            <div class="modal-header">
                <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
                <button class="modal-close" id="shortcuts-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-section">
                    <h4>üìù Editing</h4>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>Z</kbd> <span>Undo</span></div>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Z</kbd> <span>Redo</span></div>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>C</kbd> <span>Copy Selection</span></div>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>X</kbd> <span>Cut Selection</span></div>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>V</kbd> <span>Paste</span></div>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>A</kbd> <span>Select All</span></div>
                    <div class="shortcut-row"><kbd>Tab</kbd> <span>Insert Tab</span></div>
                </div>
                <div class="shortcuts-section">
                    <h4>üîé View</h4>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>T</kbd> <span>Toggle Theme</span></div>
                </div>
                <div class="shortcuts-section">
                    <h4>üìã Operations</h4>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>C</kbd> <span>Copy Code</span></div>
                    <div class="shortcut-row"><kbd>F1</kbd> <span>Show Help</span></div>
                    <div class="shortcut-row"><kbd>Esc</kbd> <span>Close Window</span></div>
                </div>
                <div class="shortcuts-section teacher-only">
                    <h4>üë®‚Äçüè´ Teacher</h4>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>Hover</kbd> <span>Laser pointer</span></div>
                    <div class="shortcut-row"><kbd>Click</kbd> line number <span>Breakpoint</span></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Student List Popup (Teacher only) -->
    <div id="student-list-popup" class="student-list-popup hidden">
        <div class="popup-header">
            <span>üë• Connected Students</span>
        </div>
        <div id="student-list-content" class="student-list-content">
            <div class="no-students">No students connected</div>
        </div>
    </div>

    <!-- Core Engine -->
    <script src="src/core/LanguageManager.js?v=3"></script>
    <script src="src/core/SmartInserter.js?v=2"></script>
    
    <!-- UI Components -->
    <script src="src/components/UIManager.js?v=2"></script>
    <script src="src/components/SyntaxHighlighter.js?v=1"></script>
    <script src="src/components/GridEditor.js?v=27"></script>
    <script src="src/components/PdfViewer.js?v=3"></script>
    <script src="src/components/MarkdownViewer.js?v=1"></script>
    <script src="src/components/FileBrowser.js?v=2"></script>
    <script src="src/components/SharedFilesBrowser.js?v=3"></script>
    <script src="src/components/LocalFileBrowser.js?v=1"></script>
    
    <!-- UI Managers -->
    <script src="src/ui/Toolbar.js?v=2"></script>
    <script src="src/ui/StatusBar.js?v=2"></script>
    <script src="src/ui/LayoutManager.js?v=1"></script>
    <script src="src/ui/LobbyManager.js?v=1"></script>
    
    <!-- Modules -->
    <script src="src/modules/FileTransfer.js?v=3"></script>
    <script src="src/modules/Collaboration.js?v=53"></script>
    
    <!-- Main Application Bootstrap -->
    <script src="src/main.js?v=1"></script>
</body>
</html>
